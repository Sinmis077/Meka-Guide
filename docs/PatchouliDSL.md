# Mekanism HandyGuide (Patchouli) #
Mekanism uses [Patchouli](https://vazkiimods.github.io/Patchouli/docs/intro) for its guide book, generated by a datagenerator - code which generates the resources.

To do so, a custom Kotlin [Type Safe Builder](https://kotlinlang.org/docs/type-safe-builders.html) Domain Specific Language (DSL) was written. The DSL largely resembles the JSON, except that the nested entries are nested in code rather than being completely separate files. This allows us to ensure that when an ID changes in the code, the guide data still works, or if we remove something then the guide entry must be removed in order to compile the mod.

Some prior knowledge of Patchouli concepts will help.

The base entrypoint for the HandyGuide can be found in [MekanismMainBookProvider](../src/datagen/main/kotlin/mekanism/patchouli/MekanismMainBookProvider.kt) for the base mod and the sub mods will have their own Providers which _add_ to the main book.

It is recommended to use IntelliJ IDEA (or another Kotlin capable IDE) to work with the HandyGuide DSL in order to benefit from syntax highlighting and autocomplete. Some basic coding knowledge is also recommended.

## Basic syntax ##
The DSL makes heavy use of _lambda expressions_ and _receiver functions_, combined with some Kotlin syntax sugar, such as operator overloads. The end result is something that looks kind of _like_ JSON, but is actually statically typed Kotlin code.

If you are not a coder or don't know Kotlin, some further independent learning will likely be required.

### Kotlin features ###

#### Lambda expressions ####
A [lambda expression](https://kotlinlang.org/docs/lambdas.html#lambda-expressions-and-anonymous-functions) is a special type of function which is passed directly as an argument to another function. In Kotlin, lambdas are written _after_ the function call's brackets (`( )`) and when they are the only argument, the brackets are omitted.
```kotlin
//These are functionally identical, both will call foo()
foo({ /* lambda body here */})
foo { /* lambda body here */}
```

#### Receiver functions ####
A [Receiver function](https://kotlinlang.org/docs/lambdas.html#function-literals-with-receiver) is a special function which takes a receiver argument. Receiver functions are called as if they existed on the receiver value's class itself. 

Inside the body of the function literal, the receiver object passed to a call becomes an implicit `this`, so that you can access the members of that receiver object without any additional qualifiers, or access the receiver object using a `this` expression.
```kotlin
fun String.doTheThing(): String { //this is a receiver function
    return substringAfter(" ") // String.substringAfter
}
println("Hello World".doTheThing()) // Prints "World"
```

#### Operator Overloads ####
One of the more cryptic parts of the DSL (and the one which will make you want to use an IDE), [operator overloads](https://kotlinlang.org/docs/operator-overloading.html) allow us to add a few shorthands to the DSL. 

The most important of which is the [invoke](https://kotlinlang.org/docs/operator-overloading.html#invoke-operator) operator, which allows us to call things as if they were functions themselves!
```kotlin
operator fun String.invoke() {
    println(this)
}

"Hello World"() // Actually prints Hello World
```

### Patchouli IDs ###
Patchouli Categories, Entries, etc have 'IDs' or 'names' which often become the file names. In the HandyGuide, all IDs **must** be defined constants.
- Category IDs must be defined in an `enum` which implements `IGuideCategory` (e.g. `mekanism.patchouli.GuideEntry`)
- Item, Block, Gas, Fluid Entries (about the block/item/etc itself) must use the Block/Item/Gas/Fluid registration entry (e.g. `mekanism.common.registries.MekanismBlocks.BRONZE_BLOCK`, usually statically imported and used as simply `BRONZE_BLOCK`) 
- Entries which don't directly map to a specific block or item must have their ID defined in an enum implementing `IGuideEntry` (e.g. `mekanism.patchouli.GuideEntry`).

### Page Links ###
Links must be inserted using string interpolation and a `link()` helper function, supplying the link target and the text to link.
```kotlin
// Will automatically link to the Electrolytic Separator's Entry.
text = "It can be placed in the ${link(ELECTROLYTIC_SEPARATOR, "Electrolytic Separator's")} hydrogen slot"
```

### Keybinds ###
Keybinds must be referenced and invoked in string interpolation from the `MekanismKeyHandler` class, this will automatically use the correct keybind.
```kotlin
text = "can be toggled by pressing the ${MekanismKeyHandler.chestModeSwitchKey()} key."
```
For vanilla, ensure you use the vanilla keybinds and not the default binding - e.g `$(k:jump)` & `$(k:sneak)`. 